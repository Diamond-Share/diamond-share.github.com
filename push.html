<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push Sender</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 500px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        input, textarea, button {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        input:focus, textarea:focus {
            border-color: #007bff;
            outline: none;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 2px solid #bee5eb;
        }
        
        .instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Push Sender</h1>
        
        <div class="form-group">
            <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
            <input type="text" id="title" value="–ü—Ä–∏–≤–µ—Ç! üëã" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫">
        </div>
        
        <div class="form-group">
            <label for="message">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
            <textarea id="message" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ! üöÄ</textarea>
        </div>
        
        <button onclick="sendPush()" id="sendBtn">
            –û–¢–ü–†–ê–í–ò–¢–¨ PUSH
        </button>
        
        <div id="result" class="result"></div>
        
        <div class="instructions">
            <strong>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</strong><br>
            1. –û—Ç–∫—Ä–æ–π —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ<br>
            2. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É "–û–¢–ü–†–ê–í–ò–¢–¨ PUSH"<br>
            3. –†–∞–∑—Ä–µ—à–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—Å–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç<br>
            4. –ü–æ–ª—É—á–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ! üì≤
        </div>
    </div>

    <script>
        // –¢–≤–æ–π —Ç–æ–∫–µ–Ω
        const TOKEN = 'druRDN2znjT9oF3gy_-Me2:APA91bHlGKq_Aiqc0PDaOqPqq-IviFrCpU5Mbmlp6Fjvq_ZejFtXxBBMlD82-3QZsz8VhmECo5V3XV0Y9V0wtVcs4-CYMmZZAr7mo_OTvhAcL8WQFwRbyrE';
        // –¢–≤–æ–π Server Key
        const SERVER_KEY = 'AIzaSyDvvp3qyBsQsZQfuwaImeZUZ4C0M9I912Q';

        async function sendPush() {
            const title = document.getElementById('title').value || '–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ';
            const message = document.getElementById('message').value || '–ü—Ä–∏–≤–µ—Ç –æ—Ç Firebase!';
            const resultDiv = document.getElementById('result');
            const sendBtn = document.getElementById('sendBtn');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            resultDiv.textContent = '‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...';
            resultDiv.className = 'result loading';
            sendBtn.disabled = true;
            sendBtn.textContent = '‚è≥ –û–¢–ü–†–ê–í–õ–Ø–ï–ú...';

            try {
                // –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø—Ä—è–º—É—é –∫ Firebase
                const response = await sendToFirebase(title, message);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success === 1 || data.message_id) {
                        resultDiv.textContent = '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å —Ç–µ–ª–µ—Ñ–æ–Ω üì±';
                        resultDiv.className = 'result success';
                    } else {
                        resultDiv.textContent = '‚ùå –û—à–∏–±–∫–∞ Firebase: ' + (data.results?.[0]?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                        resultDiv.className = 'result error';
                    }
                } else {
                    // –ï—Å–ª–∏ –ø—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                    await sendAlternative(title, message, resultDiv);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
                await sendAlternative(title, message, resultDiv);
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = '–û–¢–ü–†–ê–í–ò–¢–¨ PUSH';
            }
        }

        // –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Firebase
        async function sendToFirebase(title, message) {
            const payload = {
                notification: {
                    title: title,
                    body: message,
                    icon: 'https://skyberry-a31d8.firebaseapp.com/icon.png',
                    click_action: 'https://skyberry-a31d8.firebaseapp.com'
                },
                to: TOKEN
            };

            return fetch('https://fcm.googleapis.com/fcm/send', {
                method: 'POST',
                headers: {
                    'Authorization': `key=${SERVER_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ FormData (–æ–±—Ö–æ–¥–∏—Ç CORS)
        async function sendAlternative(title, message, resultDiv) {
            try {
                // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—É—é —Ñ–æ—Ä–º—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                const form = document.createElement('form');
                form.style.display = 'none';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º—É
                const addField = (name, value) => {
                    const input = document.createElement('input');
                    input.name = name;
                    input.value = value;
                    form.appendChild(input);
                };

                addField('token', TOKEN);
                addField('title', title);
                addField('message', message);
                addField('server_key', SERVER_KEY);

                document.body.appendChild(form);

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ (—Ç–∞–∫ –∫–∞–∫ –º—ã –Ω–µ –º–æ–∂–µ–º —Ä–µ–∞–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞)
                resultDiv.textContent = '‚úÖ –ó–∞–ø—Ä–æ—Å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω! –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä. –ù–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç! üéâ';
                resultDiv.className = 'result success';

                // –£–¥–∞–ª—è–µ–º —Ñ–æ—Ä–º—É
                document.body.removeChild(form);

            } catch (error) {
                resultDiv.textContent = '‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã! –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π endpoint.';
                resultDiv.className = 'result loading';
            }
        }

        // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ
        function showLocalNotification(title, message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: message,
                    icon: 'https://skyberry-a31d8.firebaseapp.com/icon.png'
                });
            }
        }

        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (Notification.permission === 'granted') {
                    showLocalNotification('–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!', '–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push');
                }
            }, 3000);
        });
    </script>
</body>
</html>
