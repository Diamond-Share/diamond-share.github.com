<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мега Крутое Поздравление с 18-летием!</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/TextPlugin.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/EasePack.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/MotionPathPlugin.min.js"></script>
    <style>
        :root {
            --primary: #ff3e9d;
            --secondary: #0ff;
            --accent: #f0f;
            --text: #fff;
            --bg: #111;
            --success: #00ff8c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            perspective: 1000px;
            min-height: 100vh;
            overscroll-behavior: none;
            cursor: default;
        }
        
        .screen {
            position: fixed;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1.5s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: opacity, transform;
            z-index: 1;
        }
        
        .screen.active {
            opacity: 1;
            pointer-events: all;
        }
        
        h1, h2, h3 {
            font-weight: 900;
            text-transform: uppercase;
            line-height: 1.2;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        h1 {
            font-size: clamp(2.5rem, 8vw, 5rem);
            background: linear-gradient(45deg, var(--primary), var(--accent), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 300% 300%;
            animation: gradientShift 5s ease infinite;
        }
        
        h2 {
            font-size: clamp(1.8rem, 6vw, 3rem);
            color: var(--secondary);
        }
        
        h3 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: var(--accent);
        }
        
        p {
            font-size: clamp(1.1rem, 4vw, 1.5rem);
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto 1.5rem;
        }
        
        .btn {
            position: relative;
            margin-top: 2rem;
            padding: 1rem 2.5rem;
            font-size: 1.2rem;
            font-weight: 700;
            background: transparent;
            color: var(--text);
            border: 3px solid var(--primary);
            border-radius: 50px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: 1;
            transform-style: preserve-3d;
            outline: none;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            z-index: -1;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }
        
        .btn:hover {
            color: #000;
            box-shadow: 0 0 30px rgba(255, 62, 157, 0.6);
            transform: translateY(-3px) scale(1.05);
        }
        
        .btn:hover::before {
            transform: scaleX(1);
        }
        
        .btn:active {
            transform: translateY(0) scale(0.98);
        }
        
        /* Специальные стили для экранов */
        #screen1 {
            background: radial-gradient(circle at center, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            overflow: hidden;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
            transform-style: preserve-3d;
        }
        
        .floating-elements {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
        }
        
        .floating-element {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            filter: blur(30px);
            opacity: 0.7;
        }
        
        #screen2 {
            background: linear-gradient(135deg, #1e0028 0%, #2c0055 50%, #4e007f 100%);
        }
        
        .typing-container {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 800px;
            margin: 0 auto;
            transform-style: preserve-3d;
        }
        
        .typed-text {
            min-height: 200px;
            font-size: 1.3rem;
            line-height: 1.7;
            text-align: left;
        }
        
        /* Крестик */
        .cross-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #ff0000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30vw;
            color: white;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            mix-blend-mode: multiply;
        }
        
        /* Экран с ошибками */
        .error-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: #300;
            overflow: hidden;
            font-family: 'Courier New', monospace;
        }
        
        .error-message {
            position: absolute;
            font-size: 0.9rem;
            color: #ff5555;
            background-color: rgba(136, 0, 0, 0.5);
            padding: 0.5rem;
            border: 1px solid #ff0000;
            white-space: nowrap;
        }
        
        .dark-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        /* Финальный экран */
        #screen8 {
            background: linear-gradient(135deg, #000428 0%, #004e92 100%);
            overflow: hidden;
        }
        
        .photo-frame {
            width: 300px;
            height: 300px;
            border-radius: 20px;
            margin: 2rem auto;
            position: relative;
            overflow: hidden;
            border: 5px solid var(--primary);
            box-shadow: 0 0 50px rgba(255, 62, 157, 0.5);
            transform-style: preserve-3d;
            animation: float 6s ease-in-out infinite;
        }
        
        .photo-frame::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                transparent, transparent, transparent,
                rgba(255, 255, 255, 0.1),
                transparent, transparent, transparent
            );
            transform: rotate(30deg);
            animation: shine 4s infinite;
        }
        
        @keyframes shine {
            0% { transform: rotate(30deg) translate(-30%, -30%); }
            100% { transform: rotate(30deg) translate(30%, 30%); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-20px) rotate(1deg); }
        }
        
        #birthday-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        #birthday-photo:hover {
            transform: scale(1.05);
        }
        
        /* Конфетти */
        .confetti-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: -1;
        }
        
        .confetti {
            position: absolute;
            width: 15px;
            height: 15px;
            opacity: 0;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 50%;
        }
        
        /* 3D эффекты */
        .parallax-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            will-change: transform;
        }
        
        /* Анимации */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-5px, 5px); }
            40% { transform: translate(-5px, -5px); }
            60% { transform: translate(5px, 5px); }
            80% { transform: translate(5px, -5px); }
            100% { transform: translate(0); }
        }
        
        .pulse {
            animation: pulse 3s ease-in-out infinite;
        }
        
        .glitch {
            animation: glitch 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
        }
        
        /* Прогресс бар */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 62, 157, 0.5);
        }
        
        /* Кнопка пропуска */
        .skip-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.5);
            color: var(--text);
            border: 1px solid var(--secondary);
            border-radius: 20px;
            cursor: pointer;
            z-index: 1001;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        .skip-btn:hover {
            opacity: 1;
        }
        
        /* Эффект частиц */
        .particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        /* Аудио контроллер */
        .audio-control {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            cursor: pointer;
            z-index: 1001;
            border: 1px solid var(--primary);
        }
        
        /* Эффект неонового свечения */
        .neon-text {
            text-shadow: 
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 20px currentColor,
                0 0 40px currentColor;
        }
        
        /* Модальное окно для фото */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
            box-shadow: 0 0 50px rgba(255, 62, 157, 0.8);
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
        }
        
        /* Сообщение о загрузке */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }
        
        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Социальные кнопки */
        .social-buttons {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1001;
        }
        
        .social-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--secondary);
        }
        
        .social-btn:hover {
            transform: translateY(-3px);
            background: var(--primary);
        }
        
        /* Кастомный скроллбар */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--primary), var(--accent));
            border-radius: 4px;
        }
        
        /* Эффект матрицы */
        .matrix-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            opacity: 0.3;
        }
        
        .matrix-rain {
            position: absolute;
            top: -50px;
            animation: matrix-rain 5s linear infinite;
            color: var(--success);
            font-family: 'Courier New', monospace;
            font-size: 18px;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        @keyframes matrix-rain {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
        
        /* Медиа запросы */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .typing-container {
                padding: 1rem;
            }
            
            .photo-frame {
                width: 200px;
                height: 200px;
            }
            
            .btn {
                padding: 0.8rem 1.8rem;
                font-size: 1rem;
            }
            
            .social-buttons {
                bottom: 70px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            p {
                font-size: 1rem;
            }
            
            .photo-frame {
                width: 150px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Загрузчик -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>
    
    <!-- Прогресс бар -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <!-- Кнопка пропуска -->
    <button class="skip-btn" id="skipBtn">Пропустить →</button>
    
    <!-- Аудио контроллер -->
    <div class="audio-control" id="audioControl">♪</div>
    
    <!-- Социальные кнопки -->
    <div class="social-buttons">
        <div class="social-btn" id="shareBtn">🔗</div>
        <div class="social-btn" id="replayBtn">↻</div>
    </div>
    
    <!-- Экран 1 - Стартовый -->
    <div class="screen active" id="screen1">
        <div class="floating-elements" id="floatingElements1"></div>
        <div class="matrix-container" id="matrixContainer"></div>
        <div class="hero-content">
            <h1>С Днём Рождения!</h1>
            <p>Готов к незабываемому путешествию?</p>
            <button class="btn" id="startBtn">Начать Праздник!</button>
        </div>
    </div>
    
    <!-- Экран 2 - Текст с анимацией -->
    <div class="screen" id="screen2">
        <div class="floating-elements" id="floatingElements2"></div>
        <div class="typing-container">
            <div class="typed-text" id="typedText1"></div>
        </div>
        <button class="btn" id="nextBtn2" style="display: none; opacity: 0;">Отправить →</button>
    </div>
    
    <!-- Крестик -->
    <div class="cross-overlay" id="crossOverlay">✕</div>
    
    <!-- Экран 3 -->
    <div class="screen" id="screen3">
        <div class="parallax-layer" data-depth="0.1"></div>
        <h2 data-splitting>Вот я сначала хотел сделать вот так, но...</h2>
    </div>
    
    <!-- Экран 4 -->
    <div class="screen" id="screen4">
        <div class="parallax-layer" data-depth="0.1"></div>
        <h2 data-splitting>Это было бы слишком скучно <span class="highlight">:(</span></h2>
    </div>
    
    <!-- Экран 5 - Ошибки -->
    <div class="screen" id="screen5">
        <div class="error-screen" id="errorScreen"></div>
        <div class="dark-overlay" id="darkOverlay" style="opacity: 0;">
            <div class="typing-container">
                <div class="typed-text" id="typedText5"></div>
            </div>
        </div>
    </div>
    
    <!-- Экран 6 -->
    <div class="screen" id="screen6">
        <div class="parallax-layer" data-depth="0.1"></div>
        <h2 data-splitting>ТАК СТОП!</h2>
        <h3 data-splitting>ЭТО ТУТ НЕ РЕКЛАМА</h3>
    </div>
    
    <!-- Экран 7 -->
    <div class="screen" id="screen7">
        <div class="parallax-layer" data-depth="0.1"></div>
        <div class="typing-container">
            <div class="typed-text" id="typedText7"></div>
        </div>
    </div>
    
    <!-- Экран 8 - Финальный -->
    <div class="screen" id="screen8">
        <div class="confetti-container" id="confettiContainer"></div>
        <div class="parallax-layer" data-depth="0.1"></div>
        <h1 class="pulse">С Днём Рождения!</h1>
        <div class="photo-frame">
            <img id="birthday-photo" src="https://i.ibb.co/JjqNyt1v/In-Shot-20250902-011957223.jpg" alt="Виновник торжества">
        </div>
        <div class="final-text">
            <p>Поздравляю тебя с <span class="highlight neon-text" style="color: var(--primary);">18-летием</span>!</p>
            <p>Желаю здоровья, счастья, успехов во всех делах,</p>
            <p>крепкой дружбы, верной любви и исполнения всех желаний! 🎂</p>
        </div>
        <button class="btn" id="restartBtn">Начать заново</button>
    </div>

    <!-- Модальное окно для фото -->
    <div class="modal" id="photoModal">
        <span class="close-modal" id="closeModal">&times;</span>
        <img class="modal-content" id="modalImage">
    </div>

    <!-- Аудио элементы -->
    <audio id="backgroundMusic" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-happy-birthday-to-you-493.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="clickSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="confettiSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-falling-confetti -389.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Регистрируем плагины GSAP
        gsap.registerPlugin(TextPlugin);
        
        // Тексты для каждого экрана
        const texts = {
            screen2: "С днём рождения! 🎉\n\nНу что могу сказать...\n\nЧтоб здоровье было крепким,\nмечты сбывались,\nденьги водились,\nа близкие радовали каждый день!\n\nИ конечно, чтоб всё, о чём ты мечтаешь,\nстало реальностью! 💫",
            screen5: "А вот если бы ты пользовался Hi-Fi качеством звука,\nвсего этого можно было бы избежать...\n\nНо раз уж так вышло,\nдавай перейдём к настоящему празднику! 🚀",
            screen7: "Ну что могу сказать...\n\nТы - потрясающий человек,\nи я очень рад,\nчто у меня есть возможность\nпоздравить тебя с этим днём!\n\nПоздравляю тебя с днём рождения! 🥳 П.С Жду приглашения на свадьбу 😘"
        };
        
        // Глобальные переменные
        let currentScreen = 1;
        let musicPlaying = false;
        
        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            // Скрываем загрузчик после полной загрузки
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                }, 500);
            }, 1500);
            
            // Создаем плавающие элементы
            createFloatingElements('floatingElements1', 30);
            createFloatingElements('floatingElements2', 20);
            
            // Создаем матричный эффект
            createMatrixEffect();
            
            // Настройка кнопок
            const startBtn = document.getElementById('startBtn');
            const nextBtn2 = document.getElementById('nextBtn2');
            const skipBtn = document.getElementById('skipBtn');
            const restartBtn = document.getElementById('restartBtn');
            const audioControl = document.getElementById('audioControl');
            const shareBtn = document.getElementById('shareBtn');
            const replayBtn = document.getElementById('replayBtn');
            const closeModal = document.getElementById('closeModal');
            const birthdayPhoto = document.getElementById('birthday-photo');
            
            startBtn.addEventListener('click', startCelebration);
            nextBtn2.addEventListener('click', showCross);
            skipBtn.addEventListener('click', skipToEnd);
            restartBtn.addEventListener('click', restartCelebration);
            audioControl.addEventListener('click', toggleMusic);
            shareBtn.addEventListener('click', shareCelebration);
            replayBtn.addEventListener('click', restartCelebration);
            closeModal.addEventListener('click', closePhotoModal);
            birthdayPhoto.addEventListener('click', openPhotoModal);
            
            // Параллакс эффект
            setupParallax();
            
            // Прогресс бар
            setupProgressBar();
            
            // Предзагрузка аудио
            preloadAudio();
            
            // Сброс скролла при загрузке
            window.scrollTo(0, 0);
            
            // Добавляем обработчик для клавиатуры
            document.addEventListener('keydown', handleKeyPress);
        });
        
        // Запуск праздника
        function startCelebration() {
            playSound('clickSound');
            
            // Сброс скролла
            window.scrollTo(0, 0);
            
            // Анимация перехода
            gsap.to('#screen1', {
                opacity: 0,
                duration: 1,
                ease: 'power2.inOut',
                onComplete: () => {
                    document.getElementById('screen1').classList.remove('active');
                    document.getElementById('screen2').classList.add('active');
                    
                    // Анимация появления
                    gsap.fromTo('#screen2', 
                        { y: 50, opacity: 0 },
                        { y: 0, opacity: 1, duration: 1.5, ease: 'elastic.out(1, 0.5)' }
                    );
                    
                    // Печатаем текст
                    typeText('typedText1', texts.screen2, () => {
                        // Показываем кнопку с анимацией
                        gsap.to('#nextBtn2', {
                            display: 'block',
                            opacity: 1,
                            duration: 0.8,
                            ease: 'back.out(4)'
                        });
                    });
                }
            });
            
            // Анимация кнопки
            gsap.to('#startBtn', {
                scale: 0.9,
                duration: 0.2,
                yoyo: true,
                repeat: 1,
                ease: 'power2.inOut'
            });
            
            // Обновляем прогресс
            dispatchScreenChange(2);
        }
        
        // Показать крестик
        function showCross() {
            playSound('clickSound');
            
            // Сброс скролла
            window.scrollTo(0, 0);
            
            // Анимация кнопки
            gsap.to('#nextBtn2', {
                scale: 1.1,
                duration: 0.3,
                yoyo: true,
                repeat: 1,
                ease: 'power2.inOut',
                onComplete: () => {
                    // Показываем крестик
                    const cross = document.getElementById('crossOverlay');
                    gsap.to(cross, {
                        opacity: 1,
                        duration: 0.5,
                        onComplete: () => {
                            // Анимация исчезновения крестика
                            gsap.to(cross, {
                                opacity: 0,
                                duration: 0.5,
                                delay: 0.5,
                                onComplete: () => {
                                    // Переход к следующему экрану
                                    transitionToScreen(3);
                                }
                            });
                        }
                    });
                }
            });
        }
        
        // Переход между экранами
        function transitionToScreen(screenNumber) {
            // Сброс скролла
            window.scrollTo(0, 0);
            
            // Скрываем текущий экран
            gsap.to(`#screen${currentScreen}`, {
                opacity: 0,
                duration: 1,
                ease: 'power2.inOut',
                onComplete: () => {
                    document.getElementById(`screen${currentScreen}`).classList.remove('active');
                    document.getElementById(`screen${screenNumber}`).classList.add('active');
                    
                    // Анимация появления нового экрана
                    gsap.fromTo(`#screen${screenNumber}`, 
                        { y: 100, opacity: 0 },
                        { y: 0, opacity: 1, duration: 1.5, ease: 'back.out(1.7)' }
                    );
                    
                    currentScreen = screenNumber;
                    
                    // Логика для каждого экрана
                    switch(screenNumber) {
                        case 3:
                            // Анимация текста для экрана 3
                            gsap.to('#screen3 h2', {
                                duration: 2,
                                text: {
                                    value: "Вот я сначала хотел сделать вот так, но...",
                                    speed: 0.5,
                                    delimiter: ""
                                },
                                ease: 'none',
                                onComplete: () => {
                                    setTimeout(() => {
                                        transitionToScreen(4);
                                    }, 2000);
                                }
                            });
                            break;
                            
                        case 4:
                            // Анимация текста для экрана 4
                            gsap.to('#screen4 h2', {
                                duration: 2,
                                text: {
                                    value: "Это было бы слишком скучно :(",
                                    speed: 0.5,
                                    delimiter: ""
                                },
                                ease: 'none',
                                onComplete: () => {
                                    setTimeout(() => {
                                        transitionToScreen(5);
                                        showErrors();
                                    }, 2000);
                                }
                            });
                            break;
                            
                        case 5:
                            // Ошибки уже показываются через showErrors()
                            break;
                            
                        case 6:
                            // Анимация текста для экрана 6
                            const h2 = document.querySelector('#screen6 h2');
                            const h3 = document.querySelector('#screen6 h3');
                            
                            gsap.to(h2, {
                                duration: 1.5,
                                text: {
                                    value: "ТАК СТОП!",
                                    speed: 0.3,
                                    delimiter: ""
                                },
                                ease: 'none',
                                onComplete: () => {
                                    gsap.to(h3, {
                                        duration: 2,
                                        text: {
                                            value: "ЭТО ТУТ НЕ РЕКЛАМА",
                                            speed: 0.3,
                                            delimiter: ""
                                        },
                                        ease: 'none',
                                        onComplete: () => {
                                            setTimeout(() => {
                                                transitionToScreen(7);
                                            }, 2000);
                                        }
                                    });
                                }
                            });
                            break;
                            
                        case 7:
                            // Анимация текста для экрана 7
                            typeText('typedText7', texts.screen7, () => {
                                setTimeout(() => {
                                    transitionToScreen(8);
                                    createConfetti();
                                    playSound('confettiSound');
                                }, 3000);
                            });
                            break;
                            
                        case 8:
                            // Финальный экран - ничего не делаем
                            break;
                    }
                    
                    // Обновляем прогресс
                    dispatchScreenChange(screenNumber);
                }
            });
        }
        
        // Показать ошибки
        function showErrors() {
            const errorScreen = document.getElementById('errorScreen');
            
            // Создаем много ошибок
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const error = document.createElement('div');
                    error.className = 'error-message';
                    error.textContent = `ERROR ${Math.floor(Math.random() * 10000)}: SYSTEM FAILURE [CODE: 0x${Math.floor(Math.random()*16777215).toString(16)}]`;
                    error.style.left = `${Math.random() * 90}%`;
                    error.style.top = `${Math.random() * 90}%`;
                    
                    // Анимация появления
                    gsap.fromTo(error, 
                        { opacity: 0, scale: 0.5 },
                        { 
                            opacity: 1, 
                            scale: 1, 
                            duration: 0.5,
                            onComplete: () => {
                                // Анимация исчезновения
                                setTimeout(() => {
                                    gsap.to(error, {
                                        opacity: 0,
                                        duration: 0.5,
                                        onComplete: () => error.remove()
                                    });
                                }, 2000);
                            }
                        }
                    );
                    
                    errorScreen.appendChild(error);
                }, i * 50);
            }
            
            // Показываем темный оверлей с текстом
            setTimeout(() => {
                gsap.to('#darkOverlay', {
                    opacity: 1,
                    duration: 1,
                    onComplete: () => {
                        typeText('typedText5', texts.screen5, () => {
                            setTimeout(() => {
                                transitionToScreen(6);
                            }, 3000);
                        });
                    }
                });
            }, 3000);
        }
        
        // Создать конфетти
        function createConfetti() {
            const confettiContainer = document.getElementById('confettiContainer');
            confettiContainer.innerHTML = '';
            
            for (let i = 0; i < 200; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Случайный цвет
                const colors = [
                    'linear-gradient(45deg, #ff3e9d, #0ff)',
                    'linear-gradient(45deg, #0ff, #f0f)',
                    'linear-gradient(45deg, #f0f, #ff3e9d)',
                    'linear-gradient(45deg, #00ff8c, #0ff)'
                ];
                
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = `${Math.random() * 15 + 5}px`;
                confetti.style.height = `${Math.random() * 15 + 5}px`;
                
                // Случайная позиция
                confetti.style.left = `${Math.random() * 100}%`;
                
                // Анимация
                const duration = Math.random() * 3 + 2;
                const delay = Math.random() * 2;
                
                gsap.to(confetti, {
                    y: window.innerHeight + 100,
                    rotation: Math.random() * 360,
                    opacity: 1,
                    duration: duration,
                    delay: delay,
                    ease: 'power1.out',
                    onComplete: () => {
                        confetti.remove();
                    }
                });
                
                confettiContainer.appendChild(confetti);
            }
        }
        
        // Создать плавающие элементы
        function createFloatingElements(containerId, count) {
            const container = document.getElementById(containerId);
            
            for (let i = 0; i < count; i++) {
                const element = document.createElement('div');
                element.className = 'floating-element';
                
                // Случайные размеры
                const size = Math.random() * 100 + 50;
                element.style.width = `${size}px`;
                element.style.height = `${size}px`;
                
                // Случайная позиция
                element.style.left = `${Math.random() * 100}%`;
                element.style.top = `${Math.random() * 100}%`;
                
                // Случайный цвет
                const colors = [
                    'rgba(255, 62, 157, 0.3)',
                    'rgba(0, 255, 255, 0.3)',
                    'rgba(240, 0, 255, 0.3)',
                    'rgba(0, 255, 140, 0.3)'
                ];
                element.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                // Анимация
                gsap.to(element, {
                    x: Math.random() * 100 - 50,
                    y: Math.random() * 100 - 50,
                    rotation: Math.random() * 360,
                    duration: Math.random() * 10 + 10,
                    repeat: -1,
                    yoyo: true,
                    ease: 'sine.inOut'
                });
                
                container.appendChild(element);
            }
        }
        
        // Создать матричный эффект
        function createMatrixEffect() {
            const container = document.getElementById('matrixContainer');
            const chars = '01';
            
            for (let i = 0; i < 50; i++) {
                const rain = document.createElement('div');
                rain.className = 'matrix-rain';
                
                // Случайная позиция
                rain.style.left = `${Math.random() * 100}%`;
                
                // Случайная задержка
                rain.style.animationDelay = `${Math.random() * 5}s`;
                
                // Случайная скорость
                rain.style.animationDuration = `${Math.random() * 3 + 3}s`;
                
                // Случайные символы
                let text = '';
                for (let j = 0; j < 30; j++) {
                    text += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                
                rain.textContent = text;
                container.appendChild(rain);
            }
        }
        
        // Напечатать текст с эффектом печати
        function typeText(elementId, text, onComplete) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            
            gsap.to(element, {
                duration: text.length / 20,
                text: {
                    value: text,
                    speed: 1,
                    delimiter: ""
                },
                ease: 'none',
                onComplete: onComplete
            });
        }
        
        // Пропустить к концу
        function skipToEnd() {
            playSound('clickSound');
            
            // Анимация кнопки
            gsap.to('#skipBtn', {
                scale: 0.9,
                duration: 0.2,
                yoyo: true,
                repeat: 1,
                ease: 'power2.inOut',
                onComplete: () => {
                    // Скрываем все экраны
                    document.querySelectorAll('.screen').forEach(screen => {
                        screen.classList.remove('active');
                        gsap.to(screen, { opacity: 0, duration: 0.5 });
                    });
                    
                    // Показываем финальный экран
                    document.getElementById('screen8').classList.add('active');
                    gsap.to('#screen8', { opacity: 1, duration: 1 });
                    
                    // Создаем конфетти
                    createConfetti();
                    playSound('confettiSound');
                    
                    // Обновляем прогресс
                    dispatchScreenChange(8);
                }
            });
        }
        
        // Перезапустить праздник
        function restartCelebration() {
            playSound('clickSound');
            
            // Анимация кнопки
            gsap.to('#restartBtn', {
                scale: 0.9,
                duration: 0.2,
                yoyo: true,
                repeat: 1,
                ease: 'power2.inOut',
                onComplete: () => {
                    // Скрываем все экраны
                    document.querySelectorAll('.screen').forEach(screen => {
                        screen.classList.remove('active');
                        gsap.to(screen, { opacity: 0, duration: 0.5 });
                    });
                    
                    // Показываем первый экран
                    document.getElementById('screen1').classList.add('active');
                    gsap.to('#screen1', { opacity: 1, duration: 1 });
                    
                    // Обновляем прогресс
                    dispatchScreenChange(1);
                }
            });
        }
        
        // Включить/выключить музыку
        function toggleMusic() {
            const music = document.getElementById('backgroundMusic');
            const control = document.getElementById('audioControl');
            
            if (musicPlaying) {
                music.pause();
                control.textContent = '♪';
                control.style.opacity = '0.5';
            } else {
                music.play().catch(e => console.log("Автовоспроизведение заблокировано"));
                control.textContent = '♫';
                control.style.opacity = '1';
            }
            
            musicPlaying = !musicPlaying;
            playSound('clickSound');
        }
        
        // Поделиться праздником
        function shareCelebration() {
            playSound('clickSound');
            
            if (navigator.share) {
                navigator.share({
                    title: 'С Днём Рождения!',
                    text: 'Посмотри это крутое поздравление с Днём Рождения!',
                    url: window.location.href
                })
                .catch(error => console.log('Ошибка при использовании Web Share API:', error));
            } else {
                // Копируем ссылку в буфер обмена
                navigator.clipboard.writeText(window.location.href)
                    .then(() => {
                        alert('Ссылка скопирована в буфер обмена!');
                    })
                    .catch(error => console.log('Ошибка при копировании:', error));
            }
        }
        
        // Открыть модальное окно с фото
        function openPhotoModal() {
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('modalImage');
            
            // В реальном проекте здесь будет ссылка на реальное фото
            modalImg.src = "data:image/svg+xml;utf8,<svg xmlns='https://i.ibb.co/JjqNyt1v/In-Shot-20250902-011957223.jpg width='800' height='800' viewBox='0 0 24 24' fill='none' stroke='%23ff3e9d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='12' cy='7' r='4'></circle><path d='M5 21v-2a7 7 0 0 1 14 0v2'></path></svg>";
            
            modal.style.display = 'flex';
            gsap.to(modal, { opacity: 1, duration: 0.3 });
        }
        
        // Закрыть модальное окно
        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            
            gsap.to(modal, {
                opacity: 0,
                duration: 0.3,
                onComplete: () => {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Настройка параллакс эффекта
        function setupParallax() {
            document.addEventListener('mousemove', (e) => {
                const x = (window.innerWidth / 2 - e.clientX) / 25;
                const y = (window.innerHeight / 2 - e.clientY) / 25;
                
                document.querySelectorAll('.parallax-layer').forEach(layer => {
                    const depth = parseFloat(layer.getAttribute('data-depth'));
                    gsap.to(layer, {
                        x: x * depth,
                        y: y * depth,
                        duration: 1.5,
                        ease: 'power2.out'
                    });
                });
            });
        }
        
        // Настройка прогресс бара
        function setupProgressBar() {
            const progressBar = document.getElementById('progressBar');
            
            window.addEventListener('scroll', () => {
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const progress = (scrollTop / (documentHeight - windowHeight)) * 100;
                
                gsap.to(progressBar, {
                    width: `${progress}%`,
                    duration: 0.3,
                    ease: 'power2.out'
                });
            });
        }
        
        // Предзагрузка аудио
        function preloadAudio() {
            const audioElements = document.querySelectorAll('audio');
            
            audioElements.forEach(audio => {
                audio.volume = 0.5;
                audio.preload = 'auto';
            });
        }
        
        // Воспроизвести звук
        function playSound(soundId) {
            const sound = document.getElementById(soundId);
            
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(e => console.log("Автовоспроизведение заблокировано"));
            }
        }
        
        // Обработчик нажатия клавиш
        function handleKeyPress(e) {
            // Пробел - пауза/воспроизведение музыки
            if (e.code === 'Space') {
                e.preventDefault();
                toggleMusic();
            }
            
            // Стрелка вправо - следующий экран
            if (e.code === 'ArrowRight') {
                if (currentScreen < 8) {
                    transitionToScreen(currentScreen + 1);
                }
            }
            
            // Стрелка влево - предыдущий экран
            if (e.code === 'ArrowLeft') {
                if (currentScreen > 1) {
                    transitionToScreen(currentScreen - 1);
                }
            }
            
            // Escape - пропустить к концу
            if (e.code === 'Escape') {
                skipToEnd();
            }
        }
        
        // Отправить событие изменения экрана
        function dispatchScreenChange(screenNumber) {
            currentScreen = screenNumber;
            const event = new CustomEvent('screenChange', { detail: { screen: screenNumber } });
            document.dispatchEvent(event);
        }
    </script>
</body>
</html>