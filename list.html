<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å Firebase</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: #0056b3;
        }
        
        .btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .btn-success {
            background-color: #28a745;
        }
        
        .status {
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status.success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        
        .token-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            word-break: break-all;
            text-align: left;
            font-size: 14px;
        }
        
        .instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
    </style>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
</head>
<body>
    <div class="container">
        <h1>üîî –ù–∞—Å—Ç–æ—è—â–∏–µ Push –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h1>
        
        <div class="instructions">
            <strong>–í–∞–∂–Ω–æ:</strong> –≠—Ç–æ—Ç —Å–∞–π—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ HTTPS. –ï—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–π localhost.
        </div>
        
        <div class="status info" id="status">
            –ù–∞–∂–º–∏ "–†–∞–∑—Ä–µ—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" –¥–ª—è –Ω–∞—á–∞–ª–∞
        </div>
        
        <button class="btn" id="requestPermission">
            –†–∞–∑—Ä–µ—à–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        </button>
        
        <button class="btn btn-success" id="sendTestNotification" disabled>
            –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        </button>
        
        <div id="tokenContainer" style="display: none;">
            <h3>–¢–≤–æ–π —Ç–æ–∫–µ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</h3>
            <div class="token-display" id="tokenDisplay"></div>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
        </div>
        
        <div style="margin-top: 30px; text-align: left;">
            <h3>–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ curl:</h3>
            <pre id="curlExample" style="background: #f8f9fa; padding: 15px; border-radius: 10px; overflow-x: auto;"></pre>
        </div>
    </div>

    <script>
        // –¢–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDvvp3qyBsQsZQfuwaImeZUZ4C0M9I912Q",
            authDomain: "skyberry-a31d8.firebaseapp.com",
            projectId: "skyberry-a31d8",
            storageBucket: "skyberry-a31d8.firebasestorage.app",
            messagingSenderId: "942887528624",
            appId: "1:942887528624:web:537f9f76d79d81be89b375"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const messaging = firebase.messaging();

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const requestPermissionBtn = document.getElementById('requestPermission');
        const sendTestNotificationBtn = document.getElementById('sendTestNotification');
        const statusDiv = document.getElementById('status');
        const tokenDisplay = document.getElementById('tokenDisplay');
        const tokenContainer = document.getElementById('tokenContainer');
        const curlExample = document.getElementById('curlExample');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
        function checkSupport() {
            if (!('Notification' in window)) {
                statusDiv.textContent = '‚ùå –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è';
                statusDiv.className = 'status error';
                return false;
            }
            
            if (!firebase.messaging.isSupported()) {
                statusDiv.textContent = '‚ùå Firebase Messaging –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è';
                statusDiv.className = 'status error';
                return false;
            }
            
            return true;
        }

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
        async function requestNotificationPermission() {
            if (!checkSupport()) return;

            try {
                statusDiv.textContent = '‚è≥ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ...';
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                await Notification.requestPermission();
                
                statusDiv.textContent = '‚è≥ –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...';
                
                // –ü–æ–ª—É—á–∞–µ–º FCM —Ç–æ–∫–µ–Ω
                const token = await messaging.getToken();
                
                if (token) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
                    await saveTokenToServer(token);
                    
                    statusDiv.textContent = '‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã! –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω.';
                    statusDiv.className = 'status success';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–∫–µ–Ω
                    tokenDisplay.textContent = token;
                    tokenContainer.style.display = 'block';
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ç–µ—Å—Ç–∞
                    sendTestNotificationBtn.disabled = false;
                    requestPermissionBtn.disabled = true;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä curl
                    showCurlExample(token);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    setTimeout(() => {
                        showTestNotification();
                    }, 1000);
                    
                } else {
                    statusDiv.textContent = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω';
                    statusDiv.className = 'status error';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                statusDiv.className = 'status error';
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
        async function saveTokenToServer(token) {
            console.log('–¢–æ–∫–µ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:', token);
            localStorage.setItem('fcmToken', token);
        }

        // –ü–æ–∫–∞–∑ –ø—Ä–∏–º–µ—Ä–∞ curl –∫–æ–º–∞–Ω–¥—ã
        function showCurlExample(token) {
            const example = `curl -X POST \\
  "https://fcm.googleapis.com/fcm/send" \\
  -H "Authorization: key=AIzaSyDvvp3qyBsQsZQfuwaImeZUZ4C0M9I912Q" \\
  -H "Content-Type: application/json" \\
  -d '{
    "notification": {
      "title": "–¢–µ—Å—Ç Push",
      "body": "–≠—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!",
      "icon": "https://skyberry-a31d8.firebaseapp.com/icon.png",
      "click_action": "https://skyberry-a31d8.firebaseapp.com"
    },
    "to": "${token}"
  }'`;
            
            curlExample.textContent = example;
        }

        // –ü–æ–∫–∞–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showTestNotification() {
            if (Notification.permission === 'granted') {
                new Notification('–¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω! üéâ', {
                    body: 'Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç! –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ—Ä–µ–∑ curl.',
                    icon: 'https://skyberry-a31d8.firebaseapp.com/icon.png'
                });
            }
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        async function sendTestNotification() {
            try {
                statusDiv.textContent = '‚è≥ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ...';
                
                showTestNotification();
                
                setTimeout(() => {
                    statusDiv.textContent = '‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ!';
                    statusDiv.className = 'status success';
                }, 1000);
                
            } catch (error) {
                statusDiv.textContent = '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
                statusDiv.className = 'status error';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
        messaging.onMessage((payload) => {
            console.log('–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞:', payload);
            
            if (Notification.permission === 'granted') {
                new Notification(payload.notification.title, {
                    body: payload.notification.body,
                    icon: payload.notification.icon
                });
            }
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        requestPermissionBtn.addEventListener('click', requestNotificationPermission);
        sendTestNotificationBtn.addEventListener('click', sendTestNotification);

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            if (Notification.permission === 'granted') {
                // –ï—Å–ª–∏ —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ, –ø–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
                requestNotificationPermission();
            } else if (Notification.permission === 'denied') {
                statusDiv.textContent = '‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞';
                statusDiv.className = 'status error';
            }
        });
    </script>
</body>
</html>
