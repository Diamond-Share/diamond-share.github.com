<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f2f5; margin: 0; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; max-width: 400px; width: 90%; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #0056b3; }
        .hidden { display: none; }
        .expired { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <div id="generator-ui" class="card">
        <h2>–°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—É—é —Å—Å—ã–ª–∫—É</h2>
        <p>–°—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –∂–∏—Ç—å —Ä–æ–≤–Ω–æ 10 –º–∏–Ω—É—Ç</p>
        <button onclick="createLink()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
        <div id="result" class="hidden">
            <input type="text" id="linkOutput" readonly>
            <p style="font-size: 0.8rem; color: #666;">–°–∫–æ–ø–∏—Ä—É–π –∏ –æ—Ç–∫—Ä–æ–π –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</p>
        </div>
    </div>

    <div id="secret-content" class="card hidden">
        <h2 style="color: #28a745;">üîì –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω</h2>
        <p>–≠—Ç–æ —Ç–≤–æ—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ä–∞–Ω–¥–æ–º–Ω—ã–º –∫–æ–¥–æ–º:</p>
        <h1 id="random-code" style="letter-spacing: 5px; background: #eee; padding: 10px;"></h1>
        <p id="timer" style="font-size: 0.9rem; color: #888;"></p>
    </div>

    <div id="error-404" class="card hidden">
        <h1 style="font-size: 4rem; margin: 0;">404</h1>
        <p class="expired">–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å—Å—ã–ª–∫–∏ –∏—Å—Ç–µ–∫–ª–æ –∏–ª–∏ –æ–Ω–∞ –Ω–µ–≤–µ—Ä–Ω–∞.</p>
        <a href="/">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</a>
    </div>

    <script>
        const LIFETIME = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç –≤ –º—Å

        // 1. –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
        function createLink() {
            const timestamp = Date.now();
            const randomPart = Math.random().toString(36).substring(2, 10);
            // –ö–æ–¥–∏—Ä—É–µ–º –≤—Ä–µ–º—è –∏ —Ä–∞–Ω–¥–æ–º –≤ —Å—Ç—Ä–æ–∫—É Base64
            const secretToken = btoa(`${timestamp}|${randomPart}`);
            
            const url = window.location.origin + window.location.pathname + '#' + secretToken;
            
            document.getElementById('linkOutput').value = url;
            document.getElementById('result').classList.remove('hidden');
        }

        // 2. –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkAccess() {
            const hash = window.location.hash.substring(1);
            
            if (!hash) return; // –ï—Å–ª–∏ —Ö—ç—à–∞ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä

            try {
                const decoded = atob(hash).split('|');
                const createdAt = parseInt(decoded[0]);
                const randomVal = decoded[1];
                const now = Date.now();

                // –°–∫—Ä—ã–≤–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
                document.getElementById('generator-ui').classList.add('hidden');

                if (isNaN(createdAt) || (now - createdAt) > LIFETIME) {
                    // –í–†–ï–ú–Ø –í–´–®–õ–û
                    document.getElementById('error-404').classList.remove('hidden');
                } else {
                    // –í–°–Å –û–ö - –ü–û–ö–ê–ó–´–í–ê–ï–ú –ö–û–ù–¢–ï–ù–¢
                    document.getElementById('secret-content').classList.remove('hidden');
                    document.getElementById('random-code').innerText = randomVal.toUpperCase();
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∏–∫–∞—é—â–∏–π —Ç–∞–π–º–µ—Ä –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
                    updateTimer(createdAt);
                }
            } catch (e) {
                // –ï—Å–ª–∏ –≤ —Ö—ç—à–µ –º—É—Å–æ—Ä
                document.getElementById('generator-ui').classList.add('hidden');
                document.getElementById('error-404').classList.remove('hidden');
            }
        }

        function updateTimer(start) {
            const timerElem = document.getElementById('timer');
            const interval = setInterval(() => {
                const remains = LIFETIME - (Date.now() - start);
                if (remains <= 0) {
                    clearInterval(interval);
                    location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–º, —á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞–ª–∞ 404
                } else {
                    const minutes = Math.floor(remains / 60000);
                    const seconds = Math.floor((remains % 60000) / 1000);
                    timerElem.innerText = `–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–∞–º–æ–Ω–∏—á—Ç–æ–∂–∏—Ç—Å—è —á–µ—Ä–µ–∑: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
                }
            }, 1000);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', checkAccess);
        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é –º–µ–Ω—è–µ—Ç —Ö—ç—à –≤ —Å—Ç—Ä–æ–∫–µ - —Ç–æ–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
        window.addEventListener('hashchange', () => location.reload());
    </script>
</body>
</html>
