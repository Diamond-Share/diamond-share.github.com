<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .debug { background: #f5f5f5; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h1>
    
    <div id="debugInfo" class="debug">
        <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ:</h3>
        <div id="systemInfo"></div>
    </div>

    <div id="status"></div>

    <button onclick="requestPermission()">–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ</button>
    <button onclick="testNotification()" id="testBtn" disabled>–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
    <button onclick="checkEverything()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å—ë</button>

    <script>
        const statusDiv = document.getElementById('status');
        const systemInfoDiv = document.getElementById('systemInfo');
        const testBtn = document.getElementById('testBtn');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
        function checkEverything() {
            let info = '';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Notification API
            if (!('Notification' in window)) {
                info += '<p class="error">‚ùå –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>';
            } else {
                info += '<p class="success">‚úÖ Notification API –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</p>';
                info += `<p>–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: <strong>${Notification.permission}</strong></p>`;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
            if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                info += '<p class="warning">‚ö†Ô∏è –ù—É–∂–µ–Ω HTTPS (–∫—Ä–æ–º–µ localhost)</p>';
            } else {
                info += '<p class="success">‚úÖ –ü—Ä–æ—Ç–æ–∫–æ–ª OK</p>';
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ–∫—É—Å–∞ –æ–∫–Ω–∞
            info += `<p>–û–∫–Ω–æ –≤ —Ñ–æ–∫—É—Å–µ: <strong>${document.hasFocus() ? '–î–∞' : '–ù–µ—Ç'}</strong></p>`;

            systemInfoDiv.innerHTML = info;
        }

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
        async function requestPermission() {
            if (!('Notification' in window)) {
                statusDiv.innerHTML = '<p class="error">–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>';
                return;
            }

            try {
                const permission = await Notification.requestPermission();
                statusDiv.innerHTML = `<p>–†–µ–∑—É–ª—å—Ç–∞—Ç: <strong>${permission}</strong></p>`;
                
                if (permission === 'granted') {
                    testBtn.disabled = false;
                    statusDiv.innerHTML += '<p class="success">‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</p>';
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    setTimeout(() => testNotification(), 1000);
                } else {
                    statusDiv.innerHTML += '<p class="error">‚ùå –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ</p>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">–û—à–∏–±–∫–∞: ${error.message}</p>`;
            }
        }

        // –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function testNotification() {
            if (Notification.permission !== 'granted') {
                statusDiv.innerHTML = '<p class="error">–°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>';
                return;
            }

            try {
                const notification = new Notification('üéâ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ!', {
                    body: '–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç!',
                    icon: 'https://cdn-icons-png.flaticon.com/512/733/733585.png', // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –∏–∫–æ–Ω–∫—É
                    badge: 'https://cdn-icons-png.flaticon.com/512/733/733585.png',
                    tag: 'test-notification',
                    requireInteraction: true, // –û—Å—Ç–∞–µ—Ç—Å—è –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç
                    actions: [
                        {
                            action: 'open',
                            title: '–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç'
                        }
                    ]
                });

                statusDiv.innerHTML = '<p class="success">‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ.</p>';

                notification.onclick = () => {
                    console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ clicked');
                    window.focus();
                    notification.close();
                };

                notification.onshow = () => {
                    console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ');
                    statusDiv.innerHTML += '<p>üü¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ —Å–∏—Å—Ç–µ–º–µ</p>';
                };

                notification.onclose = () => {
                    console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
                    statusDiv.innerHTML += '<p>üî¥ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ</p>';
                };

                notification.onerror = (error) => {
                    console.error('–û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    statusDiv.innerHTML += '<p class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>';
                };

            } catch (error) {
                statusDiv.innerHTML = `<p class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>`;
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkEverything();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            if (Notification.permission === 'default') {
                statusDiv.innerHTML = '<p>üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ...</p>';
                requestPermission();
            } else if (Notification.permission === 'granted') {
                testBtn.disabled = false;
                statusDiv.innerHTML = '<p class="success">‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —É–∂–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã</p>';
            }
        }, 2000);
    </script>
</body>
</html>
