<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест с регистрацией через Yandex ID</title>
    <style>
        :root {
            --primary-color: #ffcc00;
            --secondary-color: #333;
            --background-color: #f5f5f5;
            --text-color: #333;
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .page {
            display: none;
            background-color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .active {
            display: block;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--secondary-color);
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn:hover {
            background-color: #e6b800;
            transform: translateY(-2px);
        }
        
        .btn-yandex {
            background-color: #ffcc00;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin: 20px 0;
        }
        
        .btn-yandex img {
            width: 20px;
            height: 20px;
        }
        
        .question {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .options label {
            display: block;
            margin: 10px 0;
            padding: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .options label:hover {
            background-color: #f9f9f9;
        }
        
        .options input[type="radio"] {
            margin-right: 10px;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
        }
        
        .correct {
            border-left: 4px solid #4CAF50;
        }
        
        .incorrect {
            border-left: 4px solid #F44336;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid var(--primary-color);
        }
        
        .profile-info h3 {
            margin-bottom: 5px;
        }
        
        .profile-info p {
            color: #666;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            color: #F44336;
            margin-top: 10px;
            padding: 10px;
            background-color: #ffebee;
            border-radius: var(--border-radius);
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #777;
            font-size: 14px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Тест на знание веб-технологий</h1>
            <p>Пройдите тест и проверьте свои знания современных веб-технологий</p>
        </header>
        
        <!-- Страница входа -->
        <div id="login-page" class="page active">
            <h2>Вход в систему</h2>
            <p>Для прохождения теста необходимо авторизоваться через Yandex ID</p>
            
            <button id="yandex-login" class="btn btn-yandex">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjUzMzMgMEM1LjYxMzMzIDAgMCA1LjYxMzMzIDAgMTIuNTMzM0MwIDE5LjQ1MzMgNS42MTMzMyAyNS4wNjY3IDEyLjUzMzMgMjUuMDY2N0MxOS40NTMzIDI1LjA2NjcgMjUuMDY2NyAxOS40NTMzIDI1LjA2NjcgMTIuNTMzM0MyNS4wNjY3IDUuNjEzMzMgMTkuNDUzMyAwIDEyLjUzMzMgMFpNMTMuMzMzMyAxOC42NjY3VjYuNDAwMDFIMTAuNzMzM1YxOC42NjY3SDEzLjMzMzNaIiBmaWxsPSIjMDAwMDAwIi8+Cjwvc3ZnPgo=" alt="Yandex">
                Войти с Яндекс ID
            </button>
            
            <div id="login-error" class="error-message hidden"></div>
        </div>
        
        <!-- Страница приветствия -->
        <div id="welcome-page" class="page">
            <div class="user-profile">
                <img id="user-avatar" src="" alt="Аватар" class="profile-avatar">
                <div class="profile-info">
                    <h3 id="user-name">Пользователь</h3>
                    <p id="user-email"></p>
                    <p id="user-login"></p>
                </div>
            </div>
            
            <h2>Добро пожаловать на тест!</h2>
            <p>Тест состоит из 5 вопросов по веб-технологиям. У вас будет только одна попытка ответить на каждый вопрос.</p>
            <p>После завершения теста вы увидите свои результаты.</p>
            
            <button id="start-test" class="btn">Начать тест</button>
        </div>
        
        <!-- Страница теста -->
        <div id="test-page" class="page">
            <div class="user-profile">
                <img id="test-avatar" src="" alt="Аватар" class="profile-avatar">
                <div class="profile-info">
                    <h3 id="test-name">Пользователь</h3>
                    <p id="test-email"></p>
                </div>
            </div>
            
            <div class="progress-bar">
                <div id="progress" class="progress"></div>
            </div>
            
            <h2 id="question-number">Вопрос 1 из 5</h2>
            <div id="question-text" class="question"></div>
            
            <div id="options" class="options"></div>
            
            <button id="next-question" class="btn">Следующий вопрос</button>
            <div id="test-error" class="error-message hidden"></div>
        </div>
        
        <!-- Страница результатов -->
        <div id="results-page" class="page">
            <div class="user-profile">
                <img id="results-avatar" src="" alt="Аватар" class="profile-avatar">
                <div class="profile-info">
                    <h3 id="results-name">Пользователь</h3>
                    <p id="results-email"></p>
                    <p id="results-login"></p>
                </div>
            </div>
            
            <h2>Результаты теста</h2>
            
            <div id="score-container">
                <h3>Ваш результат: <span id="score">0</span> из 5</h3>
                <p id="score-message"></p>
            </div>
            
            <div id="results-details"></div>
            
            <button id="restart-test" class="btn">Пройти тест еще раз</button>
            <button id="logout" class="btn" style="background-color: #f0f0f0; margin-left: 10px;">Выйти</button>
        </div>
        
        <footer>
            <p>© 2023 Тест на знание веб-технологий. Все права защищены.</p>
        </footer>
    </div>

    <script>
        // Конфигурация приложения
        const CONFIG = {
            clientId: 'ecdee854d64e4917b7aea9c58918c665',
            clientSecret: '95c8536939114209859e5515b6049865',
            redirectUri: 'https://diamond-share.github.io/massage.html',
            scope: 'login:email login:info',
            yandexOAuthUrl: 'https://oauth.yandex.ru/authorize',
            yandexTokenUrl: 'https://oauth.yandex.ru/token',
            yandexInfoUrl: 'https://login.yandex.ru/info'
        };

        // Вопросы для теста
        const questions = [
            {
                question: "Что такое HTML?",
                options: [
                    "Язык программирования",
                    "Язык разметки гипертекста",
                    "Система управления базами данных",
                    "Фреймворк для JavaScript"
                ],
                correct: 1
            },
            {
                question: "Какая функция в JavaScript используется для вывода данных в консоль?",
                options: [
                    "print()",
                    "console.log()",
                    "display()",
                    "output()"
                ],
                correct: 1
            },
            {
                question: "Что такое CSS?",
                options: [
                    "Язык программирования",
                    "Система управления контентом",
                    "Язык таблиц стилей",
                    "База данных"
                ],
                correct: 2
            },
            {
                question: "Какой метод HTTP используется для получения данных с сервера?",
                options: [
                    "POST",
                    "PUT",
                    "GET",
                    "DELETE"
                ],
                correct: 2
            },
            {
                question: "Что такое API?",
                options: [
                    "Автоматизированный процесс интеграции",
                    "Интерфейс программирования приложений",
                    "Автоматическая передача информации",
                    "Асинхронный программный интерфейс"
                ],
                correct: 1
            }
        ];

        // Переменные состояния
        let currentQuestion = 0;
        let userAnswers = [];
        let userData = null;

        // Элементы DOM
        const loginPage = document.getElementById('login-page');
        const welcomePage = document.getElementById('welcome-page');
        const testPage = document.getElementById('test-page');
        const resultsPage = document.getElementById('results-page');
        const yandexLoginBtn = document.getElementById('yandex-login');
        const startTestBtn = document.getElementById('start-test');
        const nextQuestionBtn = document.getElementById('next-question');
        const restartTestBtn = document.getElementById('restart-test');
        const logoutBtn = document.getElementById('logout');
        const questionNumber = document.getElementById('question-number');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options');
        const progressBar = document.getElementById('progress');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');
        const userLogin = document.getElementById('user-login');
        const userAvatar = document.getElementById('user-avatar');
        const testName = document.getElementById('test-name');
        const testEmail = document.getElementById('test-email');
        const testAvatar = document.getElementById('test-avatar');
        const resultsName = document.getElementById('results-name');
        const resultsEmail = document.getElementById('results-email');
        const resultsLogin = document.getElementById('results-login');
        const resultsAvatar = document.getElementById('results-avatar');
        const scoreElement = document.getElementById('score');
        const scoreMessage = document.getElementById('score-message');
        const resultsDetails = document.getElementById('results-details');
        const loginError = document.getElementById('login-error');
        const testError = document.getElementById('test-error');

        // Инициализация приложения
        function init() {
            // Проверяем, есть ли токен в URL (возврат из OAuth)
            const urlParams = new URLSearchParams(window.location.hash.substring(1));
            const accessToken = urlParams.get('access_token');
            
            if (accessToken) {
                // Сохраняем токен и получаем информацию о пользователе
                localStorage.setItem('yandexToken', accessToken);
                getUserInfo(accessToken);
                
                // Убираем параметры из URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                // Проверяем, есть ли сохраненный токен
                const savedToken = localStorage.getItem('yandexToken');
                if (savedToken) {
                    getUserInfo(savedToken);
                }
            }
            
            // Назначаем обработчики событий
            yandexLoginBtn.addEventListener('click', initiateYandexLogin);
            startTestBtn.addEventListener('click', startTest);
            nextQuestionBtn.addEventListener('click', nextQuestion);
            restartTestBtn.addEventListener('click', restartTest);
            logoutBtn.addEventListener('click', logout);
            
            // Обработчик выбора ответа
            document.addEventListener('change', function(e) {
                if (e.target.name === 'answer') {
                    nextQuestionBtn.style.display = 'inline-block';
                    testError.classList.add('hidden');
                }
            });
        }

        // Инициировать вход через Yandex ID
        function initiateYandexLogin() {
            const authUrl = `${CONFIG.yandexOAuthUrl}?response_type=token&client_id=${CONFIG.clientId}&redirect_uri=${encodeURIComponent(CONFIG.redirectUri)}&scope=${CONFIG.scope}`;
            window.location.href = authUrl;
        }

        // Получить информацию о пользователе
        async function getUserInfo(token) {
            try {
                showLoading(yandexLoginBtn, true);
                
                // Запрос к Yandex API для получения информации о пользователе
                const response = await fetch(CONFIG.yandexInfoUrl, {
                    headers: {
                        'Authorization': `OAuth ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Ошибка API: ${response.status}`);
                }
                
                const userInfo = await response.json();
                userData = userInfo;
                showWelcomePage(userInfo);
                
            } catch (error) {
                console.error('Ошибка получения информации о пользователе:', error);
                showLoginError('Не удалось получить информацию о пользователе. Попробуйте войти снова.');
                
                // Очищаем невалидный токен
                localStorage.removeItem('yandexToken');
            } finally {
                showLoading(yandexLoginBtn, false);
            }
        }

        // Показать/скрыть индикатор загрузки
        function showLoading(button, isLoading) {
            if (isLoading) {
                button.disabled = true;
                button.innerHTML = '<div class="loading"></div> Загрузка...';
            } else {
                button.disabled = false;
                button.innerHTML = '<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyLjUzMzMgMEM1LjYxMzMzIDAgMCA1LjYxMzMzIDAgMTIuNTMzM0MwIDE5LjQ1MzMgNS42MTMzMyAyNS4wNjY3IDEyLjUzMzMgMjUuMDY2N0MxOS40NTMzIDI1LjA2NjcgMjUuMDY2NyAxOS40NTMzIDI1LjA2NjcgMTIuNTMzM0MyNS4wNjY3IDUuNjEzMzMgMTkuNDUzMyAwIDEyLjUzMzMgMFpNMTMuMzMzMyAxOC42NjY3VjYuNDAwMDFIMTAuNzMzM1YxOC42NjY3SDEzLjMzMzNaIiBmaWxsPSIjMDAwMDAwIi8+Cjwvc3ZnPgo=" alt="Yandex"> Войти с Яндекс ID';
            }
        }

        // Показать страницу приветствия
        function showWelcomePage(userInfo) {
            loginPage.classList.remove('active');
            welcomePage.classList.add('active');
            
            updateUserProfile(userInfo, userName, userEmail, userLogin, userAvatar);
        }

        // Обновить профиль пользователя
        function updateUserProfile(userInfo, nameElement, emailElement, loginElement, avatarElement) {
            // Отображаем ФИО пользователя
            const displayName = userInfo.real_name || userInfo.display_name || 
                               (userInfo.first_name && userInfo.last_name ? `${userInfo.first_name} ${userInfo.last_name}` : userInfo.login);
            nameElement.textContent = displayName;
            
            // Отображаем email
            emailElement.textContent = userInfo.default_email || userInfo.emails?.[0] || 'Email не указан';
            
            // Отображаем логин
            if (loginElement) {
                loginElement.textContent = `Логин: ${userInfo.login}`;
            }
            
            // Устанавливаем аватар
            if (userInfo.default_avatar_id && !userInfo.is_avatar_empty) {
                avatarElement.src = `https://avatars.yandex.net/get-yapic/${userInfo.default_avatar_id}/islands-200`;
            } else {
                // Заглушка для аватара
                avatarElement.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjRjBGMEYwIi8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjgwIiByPSI0MCIgZmlsbD0iI0NDQyIvPgo8cGF0aCBkPSJNNDAgMTYwQzQwIDEzOC41MTEgNTYuNTEyMiAxMjAgODAgMTIwSDEyMEMxNDMuNDg4IDEyMCAxNjAgMTM4LjUxMSAxNjAgMTYwVjE2MEg0MFYxNjBaIiBmaWxsPSIjQ0NDIi8+Cjwvc3ZnPgo=';
            }
        }

        // Показать ошибку входа
        function showLoginError(message) {
            loginError.textContent = message;
            loginError.classList.remove('hidden');
        }

        // Начать тест
        function startTest() {
            welcomePage.classList.remove('active');
            testPage.classList.add('active');
            
            // Обновляем профиль на странице теста
            updateUserProfile(userData, testName, testEmail, null, testAvatar);
            
            currentQuestion = 0;
            userAnswers = [];
            
            displayQuestion();
        }

        // Отобразить вопрос
        function displayQuestion() {
            const question = questions[currentQuestion];
            
            questionNumber.textContent = `Вопрос ${currentQuestion + 1} из ${questions.length}`;
            questionText.textContent = question.question;
            
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="radio" name="answer" value="${index}">
                    ${option}
                `;
                optionsContainer.appendChild(label);
            });
            
            // Обновить прогресс-бар
            const progress = ((currentQuestion) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
            
            // Скрыть кнопку "Следующий вопрос" до выбора ответа
            nextQuestionBtn.style.display = 'none';
            
            // Показать ошибку, если она есть
            testError.classList.add('hidden');
        }

        // Следующий вопрос
        function nextQuestion() {
            const selectedOption = document.querySelector('input[name="answer"]:checked');
            
            if (!selectedOption) {
                testError.textContent = 'Пожалуйста, выберите ответ';
                testError.classList.remove('hidden');
                return;
            }
            
            userAnswers[currentQuestion] = parseInt(selectedOption.value);
            
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        // Показать результаты
        function showResults() {
            testPage.classList.remove('active');
            resultsPage.classList.add('active');
            
            // Обновляем профиль на странице результатов
            updateUserProfile(userData, resultsName, resultsEmail, resultsLogin, resultsAvatar);
            
            // Рассчитать результат
            let score = 0;
            questions.forEach((question, index) => {
                if (userAnswers[index] === question.correct) {
                    score++;
                }
            });
            
            scoreElement.textContent = score;
            
            // Показать сообщение в зависимости от результата
            if (score === questions.length) {
                scoreMessage.textContent = 'Отличный результат! Вы отлично разбираетесь в веб-технологиях.';
            } else if (score >= questions.length * 0.7) {
                scoreMessage.textContent = 'Хороший результат! Вы хорошо разбираетесь в веб-технологиях.';
            } else if (score >= questions.length * 0.5) {
                scoreMessage.textContent = 'Неплохой результат! Есть что повторить.';
            } else {
                scoreMessage.textContent = 'Вам стоит уделить больше времени изучению веб-технологий.';
            }
            
            // Показать детали результатов
            resultsDetails.innerHTML = '';
            questions.forEach((question, index) => {
                const resultItem = document.createElement('div');
                resultItem.className = `result-item ${userAnswers[index] === question.correct ? 'correct' : 'incorrect'}`;
                
                const userAnswer = question.options[userAnswers[index]];
                const correctAnswer = question.options[question.correct];
                
                resultItem.innerHTML = `
                    <h4>Вопрос ${index + 1}: ${question.question}</h4>
                    <p><strong>Ваш ответ:</strong> ${userAnswer}</p>
                    <p><strong>Правильный ответ:</strong> ${correctAnswer}</p>
                `;
                
                resultsDetails.appendChild(resultItem);
            });
        }

        // Начать тест заново
        function restartTest() {
            resultsPage.classList.remove('active');
            welcomePage.classList.add('active');
        }

        // Выйти из системы
        function logout() {
            localStorage.removeItem('yandexToken');
            userData = null;
            resultsPage.classList.remove('active');
            loginPage.classList.add('active');
        }

        // Запуск приложения
        init();
    </script>
</body>
</html>
